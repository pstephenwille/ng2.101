<#include "../variables.ftl" />
<#include "../functions.ftl" />
<#include "/default/includes/loyalty/rewards/rewardsbranding.ftl"/>

<#macro register>
    <@template id="wizard-rooms-and-rates">
        <div class="segment-title">
            <h2 id="availability-header" class="title-main">
                <@loc.msg id="chooseYourRoom"/>
            </h2>
            <div id="availability-wizard-container">{{!WizardView}}</div>
        </div>
        <article class="segment no-target segment-title rooms-and-rates-segment">
            {{!RoomsAndRatesView}}
        </article>
    </@template>

    <@template id="hierarchical-room-template">
        {{#if hasOffers}}
            <thead id="rooms-header">
            <tr>
                <th id="room-type-header"><@loc.msg id="roomTypeHeader"/></th>
                <th id="rate-features-header"><@loc.msg id="rateFeaturesHeader"/></th>
                {{#if displayExpediaRewardsColumn}}
                    <th id="rewards-header"><@loc.msg id="expediaRewardsHeader"/></th>
                {{/if}}

                <#-- Price column title (Could be either Total, or Avg rate per night) -->
                <#if roomsAndRates.isPriceDisplayTotal()>
                    <#assign priceColumnTitle><@loc.msg id="totalLabel"/></#assign>
                <#else>
                    <#assign priceColumnTitle><@loc.msg id="avgLabel"/></#assign>
                </#if>
                <th id="avg-rate-header">${priceColumnTitle}</th>
                <th id="book-button-header">
                    <span class="visuallyhidden"><@loc.msg id="bookButtonHeader"/></span>
                </th>
            </tr>
            </thead>
            {{#each rooms}}
                <tbody class="room room-above-fold {{#if showBestValue}}first-room-featured{{/if}} {{#if isSingleOfferRoom}}single-offer-room{{/if}}">
                    {{#if @index}}
                        <tr class="rooms-and-rates-margin">
                            <td colspan="{{../../descripColspan}}"></td>
                        </tr>
                    {{/if}}
                    {{#each offers}}
                        <tr class="rate-plan {{#if isFeaturedOffer}}rate-plan-first{{/if}}">
                            {{#unless @index}}
                            <td rowspan="{{../../offerCount}}" class="room-info">
                                {{> room-thumbnails-template ../../photos}}
                                {{> room-basic-information-template ../..}}
                            </td>
                            {{/unless}}

                            <td class="rate-features">
                                {{#if mrp}}
                                    {{> mrp-deal-template this}}
                                {{else}}
                                    {{> rate-features-template this}}
                                {{/if}}
                            </td>

                            <#-- Rewards Member Coupon (Expedia.com loyalty) -->
                            {{#if ../../displayExpediaRewardsColumn}}
                                <td class="expedia-rewards">
                                    {{> rewards-member-coupon-template this}}
                                </td>
                            {{/if}}
                            <td class="avg-rate">
                                {{#if bookable}}
                                    <#-- Room pricing -->
                                    {{> room-pricing-template this}}

                                    <#-- Room deal message -->
                                    {{> room-deal-message-template this}}

                                    <#-- TAAP WRAPPER START: Display show commission link if it is a taap user-->
                                    {{#if displayTaapContent}}
                                        {{> taap-commission-tooltip-template this}}
                                    {{/if}}
                                    <#-- TAAP WRAPPER END-->

                                {{else}}
                                     <#-- Room unavailable message -->
                                    {{> room-unavailable-message-template this}}
                                {{/if}}
                            </td>

                           <td class="book-button-column">
                                {{#if bookable}}
                                    {{#if mrp}}
                                        {{> mrp-book-button-template this}}
                                    {{else}}
                                        {{#if payLaterOffer}}
                                            {{> etp-book-button-template this}}
                                        {{else}}
                                            {{#if depositOffer}}
                                                {{> etp-book-button-template this}}
                                            {{else}}
                                                {{> book-button-template this}}
                                            {{/if}}
                                        {{/if}}
                                    {{/if}}
                                {{/if}}
                            </td>
                        </tr>
                    {{/each}}
                </tbody>
            {{/each}}
        {{/if}}
    </@template>

    <@template id="nightly-rates-template">
        {{#if nightlyRates}}
            <table class="nightly-rates" summary="All nightly rates">
                {{#each nightlyRates}}
                    <tbody>
                        <tr>
                            <th class="week-header" colspan="{{this.length}}" scope="row"><@loc.msg id="weekNumber"/></th>
                        </tr>
                        <tr>
                            {{#each .}}
                                <th class="day-header" scope="col">{{dayOfWeek}}</th>
                            {{/each}}
                        </tr>
                        <tr>
                            <#-- TODO: Private Deals?? -->
                            {{#each .}}
                                <td class="nightly-rate">
                                    {{#if available}}
                                        {{#if crossOutPrice}}
                                            <span class="visuallyhidden"><@loc.msg id="thePriceWas"/></span>
                                            <span class="cross-out-price">{{crossOutPrice}}</span>
                                        {{/if}}
                                        <span class="visuallyhidden"><@loc.msg id="thePriceIs"/></span>
                                        {{displayPrice}}
                                    {{else}}
                                        X
                                    {{/if}}
                                </td>
                            {{/each}}
                        </tr>
                    </tbody>
                {{/each}}
            </table>
        {{/if}}
    </@template>

    <@template id="room-thumbnails-template">
        {{#each .}}
            {{#unless @index}}
                <#-- TODO: Multiple/Large room photos -->
                <div class="room-thumbnail">
                    {{#if caption}}
                        <@uitk.figure classes="large-thumbnail squared-thumbnail" src="{{thumbnailUrl}}" alt="{{caption}}" lazy="true" aspectRatio="1-1"/>
                        <@uitk.figure classes="large-thumbnail rec-thumbnail" src="{{largeUrl}}" alt="{{caption}}" lazy="true" aspectRatio="16-9"/>
                    {{else}}
                        {{#if name}}
                            <#assign altTextRoomName><@loc.msg id="altTextRoomName" /></#assign>
                            <@uitk.figure classes="large-thumbnail squared-thumbnail" src="{{thumbnailUrl}}" alt="${altTextRoomName}" lazy="true" aspectRatio="1-1"/>
                            <@uitk.figure classes="large-thumbnail rec-thumbnail" src="{{largeUrl}}" alt="${altTextRoomName}" lazy="true" aspectRatio="16-9"/>
                        {{else}}
                            <#assign altText><@loc.msg id="altText" /></#assign>
                            <@uitk.figure classes="large-thumbnail squared-thumbnail" src="{{thumbnailUrl}}" alt="${altText}" lazy="true" aspectRatio="1-1"/>
                            <@uitk.figure classes="large-thumbnail rec-thumbnail" src="{{largeUrl}}" alt="${altText}" lazy="true" aspectRatio="16-9"/>
                        {{/if}}
                    {{/if}}
                    <#--
                    <img src="/static/default/default/images/infosite/larger-image-icon.png" class="larger-image-icon" alt="">
                    -->
                </div>
            {{/unless}}
        {{/each}}
    </@template>

    <@template id="room-basic-information-template">
        <div class="room-basic-info">
            <#-- Best Value -->
            {{#if showBestValue}}
                <div class="best-value">
                    <@uitk.icon name="shop"/>&nbsp;<@loc.msg id="bestValue"/>
                </div>
            {{/if}}

            <#-- Begin 9925: HCore_MultiSourceTest -->
            <#assign multiSourceLimitedDetails><@loc.msg id='multiSourceLimitedDetails'/></#assign>
            <#assign bookSecurely><@loc.msg id='bookSecurely'/></#assign>
            <#-- End 9925: HCore_MultiSourceTest -->

            <#-- Room Name -->
            <#-- Room Description (Menu) -->
            <#-- Begin 9784: GROHISRoomsAndRatesInfoModule -->
            {{#exp 9784 0}}
            <#-- End 9784: GROHISRoomsAndRatesInfoModule -->
                {{#if description}}
                    <@uitk.menuBar classes="room-description-menu-bar">
                        <@uitk.menu triggerTitle="{{name}}" position="left" arrow="true" close="true" classes="room-description-menu"
                            dataAttributes="track:HOT.HIS.RoomsAndRates.ShowRoomInformation">
                            <@uitk.menuContent>
                                {{#each description}}
                                    <div class="paragraph-hack">{{{this}}}</div>
                                {{/each}}
                                <#-- Begin 9925: HCore_MultiSourceTest -->
                                {{#if this.offers.[0].multiSource}}
                                    <div class="paragraph-hack"><br/>${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                {{/if}}
                                <#-- End 9925: HCore_MultiSourceTest -->
                            </@uitk.menuContent>
                        </@uitk.menu>
                    </@uitk.menuBar>
                {{else}}
                    <#-- Begin 9925: HCore_MultiSourceTest -->
                    {{#if this.offers.[0].multiSource}}
                        <@uitk.menuBar classes="room-description-menu-bar">
                            <@uitk.menu triggerTitle="{{name}}" position="left" arrow="true" close="true" classes="room-description-menu">
                                <@uitk.menuContent>
                                    <div class="paragraph-hack">${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                </@uitk.menuContent>
                            </@uitk.menu>
                        </@uitk.menuBar>
                    {{else}}
                    <#-- End 9925: HCore_MultiSourceTest -->
                        <h3 class="room-name">{{name}}</h3>
                    <#-- Begin 9925: HCore_MultiSourceTest -->
                    {{/if}}
                    <#-- End 9925: HCore_MultiSourceTest -->
                {{/if}}
            <#-- Begin 9784: GROHISRoomsAndRatesInfoModule -->
            {{else}}
                {{#exp 9784 5}}
                    {{#if description}}
                        <#assign roomsAndRatesInfoIcon>
                            <span class="icon icon-info" aria-hidden="true"></span>
                        </#assign>
                        <@uitk.menuBar classes="exp9784-5 room-description-menu-bar">
                            <@uitk.menu triggerTitle="${roomsAndRatesInfoIcon}{{name}}" position="left" arrow="true" close="true" classes="room-description-menu"
                            dataAttributes="track:HOT.HIS.RoomsAndRates.ShowRoomInformation">
                                <@uitk.menuContent>
                                    {{#each description}}
                                        <div class="paragraph-hack">{{{this}}}</div>
                                    {{/each}}
                                    <#-- Begin 9925: HCore_MultiSourceTest -->
                                    {{#if this.offers.[0].multiSource}}
                                        <div class="paragraph-hack"><br/>${multiSourceLimitedDetails}</div>
                                        <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                    {{/if}}
                                    <#-- End 9925: HCore_MultiSourceTest -->
                                </@uitk.menuContent>
                            </@uitk.menu>
                        </@uitk.menuBar>
                    {{else}}
                        <#-- Begin 9925: HCore_MultiSourceTest -->
                        {{#if this.offers.[0].multiSource}}
                            <@uitk.menuBar classes="room-description-menu-bar">
                                <@uitk.menu triggerTitle="{{name}}" position="left" arrow="true" close="true" classes="room-description-menu">
                                    <@uitk.menuContent>
                                        <div class="paragraph-hack">${multiSourceLimitedDetails}</div>
                                        <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                    </@uitk.menuContent>
                                </@uitk.menu>
                            </@uitk.menuBar>
                        {{else}}
                        <#-- End 9925: HCore_MultiSourceTest -->
                            <h3 class="exp9784-5 room-name">{{name}}</h3>
                        <#-- Begin 9925: HCore_MultiSourceTest -->
                        {{/if}}
                        <#-- End 9925: HCore_MultiSourceTest -->
                    {{/if}}
                {{else}}
                    {{#exp 9784 1}}<h3 class="exp9784-1 room-name">{{name}}</h3>{{/exp}}
                    {{#exp 9784 2}}<h3 class="exp9784-2 room-name">{{name}}</h3>{{/exp}}
                    {{#exp 9784 3}}<h3 class="exp9784-3 room-name">{{name}}</h3>{{/exp}}
                    {{#exp 9784 4}}<h3 class="exp9784-4 room-name">{{name}}</h3>{{/exp}}
                {{/exp}}
            {{/exp}}
            <#-- End 9784: GROHISRoomsAndRatesInfoModule -->

            {{#if hasRoomView}}
                <@uitk.badge classes="room-with-view"><@loc.msg id="roomWithView"/></@uitk.badge>
            {{/if}}

            <#-- Room Area -->
            <span class="square-area">
                <#assign isShowAreaInSqFt = hotelConfig.isShowAreaInSqFt()>
                <#assign unknownArea><@loc.msg id="unknownArea"/></#assign>
                <#if isShowAreaInSqFt>
                    {{#if roomSquareFeet}}
                        <@loc.msg id="squareFeet"/>
                    {{/if}}
                <#else>
                    {{#if roomSquareMeters}}
                        <@loc.msg id="squareMeters"/>
                    {{/if}}
                </#if>
            </span>

            <#-- Bed Types -->
            {{#if beddingOptions}}
                <div class="bed-types {{#if extraBeddingOptions}}bold-bed-types{{/if}}">{{beddingOptions}}</div>
                {{#if extraBeddingOptions}}
                    <div class="extra-bed-types">
                        (<@loc.msg id="extraBedding_ExtraBeds"/>
                        {{#if cribBeddingAndRollawayBedding}}
                            <@loc.msg id="extraBedding_Crib"/>, <@loc.msg id="extraBedding_RollawayBed"/>)
                        {{else}}
                            {{#if cribBedding}}
                                <@loc.msg id="extraBedding_Crib"/>)
                            {{else}}
                                {{#if rollawayBedding}}
                                    <@loc.msg id="extraBedding_RollawayBed"/>)
                                {{/if}}
                            {{/if}}
                        {{/if}}
                    </div>
                {{/if}}
            {{/if}}

            <#-- Max occupancy -->
            {{#if maxOccupancyValid}}
                <#assign isShowAreaInSqFt = hotelConfig.isShowAreaInSqFt()>
                <p class="max-occupancy-text">
                    <span class="max-guest-msg">
                        {{#if isMaxGuestsSingular}}
                            <@loc.msg id="maxGuests_Singular"/>
                        {{else}}
                            <@loc.msg id="maxGuests_Plural"/>
                        {{/if}}
                    </span>
                    {{#if maxChildren}}
                        <span class="child-msg">
                            {{#if isMaxChildrenSingular}}
                            <@loc.msg id="maxChildren_Singular"/>
                            {{else}}
                            <@loc.msg id="maxChildren_Plural"/>
                            {{/if}}
                        </span>
                    {{/if}}
                </p>
            {{/if}}

            <#-- Begin 9784: GROHISRoomsAndRatesInfoModule -->
            {{#exp 9784 1}}
                {{#if description}}
                    <#assign roomsAndRatesInfoTitle>
                        <@loc.msg id="moreDetails"/>
                    </#assign>

                    <@uitk.menuBar classes="exp9784-1 room-description-menu-bar">
                        <@uitk.menu triggerTitle="${roomsAndRatesInfoTitle}" position="left" arrow="true" close="true" classes="room-description-menu"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.ShowRoomInformation">
                            <@uitk.menuContent>
                                {{#each description}}
                                    <div class="paragraph-hack">{{{this}}}</div>
                                {{/each}}
                                <#-- Begin 9925: HCore_MultiSourceTest -->
                                {{#if this.offers.[0].multiSource}}
                                    <div class="paragraph-hack"><br/>${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                {{/if}}
                                <#-- End 9925: HCore_MultiSourceTest -->
                            </@uitk.menuContent>
                        </@uitk.menu>
                    </@uitk.menuBar>
                {{else}}
                    <#-- Begin 9925: HCore_MultiSourceTest -->
                    {{#if this.offers.[0].multiSource}}
                        <@uitk.menuBar classes="room-description-menu-bar">
                            <@uitk.menu triggerTitle="{{name}}" position="left" arrow="true" close="true" classes="room-description-menu">
                                <@uitk.menuContent>
                                    <div class="paragraph-hack">${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                </@uitk.menuContent>
                            </@uitk.menu>
                        </@uitk.menuBar>
                    {{/if}}
                    <#-- End 9925: HCore_MultiSourceTest -->
                {{/if}}
            {{/exp}}
            {{#exp 9784 2}}
                {{#if description}}
                    <#assign roomsAndRatesInfoTitle>
                        <@loc.msg id="showMore"/>
                    </#assign>

                    <@uitk.menuBar classes="exp9784-2 room-description-menu-bar">
                        <@uitk.menu triggerTitle="${roomsAndRatesInfoTitle}" position="left" arrow="true" close="true" classes="room-description-menu"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.ShowRoomInformation">
                            <@uitk.menuContent>
                                {{#each description}}
                                    <div class="paragraph-hack">{{{this}}}</div>
                                {{/each}}
                                <#-- Begin 9925: HCore_MultiSourceTest -->
                                {{#if this.offers.[0].multiSource}}
                                    <div class="paragraph-hack"><br/>${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                {{/if}}
                                <#-- End 9925: HCore_MultiSourceTest -->
                            </@uitk.menuContent>
                        </@uitk.menu>
                    </@uitk.menuBar>
                {{else}}
                    <#-- Begin 9925: HCore_MultiSourceTest -->
                    {{#if this.offers.[0].multiSource}}
                        <@uitk.menuBar classes="room-description-menu-bar">
                            <@uitk.menu triggerTitle="{{name}}" position="left" arrow="true" close="true" classes="room-description-menu">
                                <@uitk.menuContent>
                                    <div class="paragraph-hack">${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                </@uitk.menuContent>
                            </@uitk.menu>
                        </@uitk.menuBar>
                    {{/if}}
                    <#-- End 9925: HCore_MultiSourceTest -->
                {{/if}}
            {{/exp}}
            {{#exp 9784 3}}
                {{#if description}}
                    <#assign roomsAndRatesInfoTitle>
                        <span class="icon icon-info" aria-hidden="true"></span>&nbsp;<@loc.msg id="moreDetails"/>
                    </#assign>

                    <@uitk.menuBar classes="exp9784-3 room-description-menu-bar">
                        <@uitk.menu triggerTitle="${roomsAndRatesInfoTitle}" position="left" arrow="true" close="true" classes="room-description-menu"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.ShowRoomInformation">
                            <@uitk.menuContent>
                                {{#each description}}
                                    <div class="paragraph-hack">{{{this}}}</div>
                                {{/each}}
                                <#-- Begin 9925: HCore_MultiSourceTest -->
                                {{#if this.offers.[0].multiSource}}
                                    <div class="paragraph-hack"><br/>${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                {{/if}}
                                <#-- End 9925: HCore_MultiSourceTest -->
                            </@uitk.menuContent>
                        </@uitk.menu>
                    </@uitk.menuBar>
                {{else}}
                    <#-- Begin 9925: HCore_MultiSourceTest -->
                    {{#if this.offers.[0].multiSource}}
                        <@uitk.menuBar classes="room-description-menu-bar">
                            <@uitk.menu triggerTitle="{{name}}" position="left" arrow="true" close="true" classes="room-description-menu">
                                <@uitk.menuContent>
                                    <div class="paragraph-hack">${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                </@uitk.menuContent>
                            </@uitk.menu>
                        </@uitk.menuBar>
                    {{/if}}
                    <#-- End 9925: HCore_MultiSourceTest -->
                {{/if}}
            {{/exp}}
            {{#exp 9784 4}}
                {{#if description}}
                    <#assign roomsAndRatesInfoTitle>
                        <span class="icon icon-info" aria-hidden="true"></span>&nbsp;<@loc.msg id="showMore"/>
                    </#assign>

                    <@uitk.menuBar classes="exp9784-4 room-description-menu-bar">
                        <@uitk.menu triggerTitle="${roomsAndRatesInfoTitle}" position="left" arrow="true" close="true" classes="room-description-menu"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.ShowRoomInformation">
                            <@uitk.menuContent>
                                {{#each description}}
                                    <div class="paragraph-hack">{{{this}}}</div>
                                {{/each}}
                                <#-- Begin 9925: HCore_MultiSourceTest -->
                                {{#if this.offers.[0].multiSource}}
                                    <div class="paragraph-hack"><br/>${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                {{/if}}
                                <#-- End 9925: HCore_MultiSourceTest -->
                            </@uitk.menuContent>
                        </@uitk.menu>
                    </@uitk.menuBar>
                {{else}}
                    <#-- Begin 9925: HCore_MultiSourceTest -->
                    {{#if this.offers.[0].multiSource}}
                        <@uitk.menuBar classes="room-description-menu-bar">
                            <@uitk.menu triggerTitle="{{name}}" position="left" arrow="true" close="true" classes="room-description-menu">
                                <@uitk.menuContent>
                                    <div class="paragraph-hack">${multiSourceLimitedDetails}</div>
                                    <div class="paragraph-hack"><br/>${bookSecurely}</div>
                                </@uitk.menuContent>
                            </@uitk.menu>
                        </@uitk.menuBar>
                    {{/if}}
                    <#-- End 9925: HCore_MultiSourceTest -->
                {{/if}}
            {{/exp}}
            <#-- End 9784: GROHISRoomsAndRatesInfoModule -->

            <#-- Begin 10398: HIS_GuestReviews_LinkRoomLevelReviews_Test -->
            {{#exp 10398 1 2}}
                <a href="#section-reviews" class="room-level-reviews" data-id="{{roomTypeCode}}"></a>
            {{/exp}}
            <#-- End 10398: HIS_GuestReviews_LinkRoomLevelReviews_Test -->
        </div>
    </@template>

    <@template id="room-amenity">
        <div class="room-amenity {{classes}}">
            {{#if icon}}
            <span class="icon icon-{{icon}}" aria-hidden="true"></span>
            {{/if}}
            <span class="free-text" {{#if automationId}}data-auto-id="{{automationId}}"{{/if}}>
            {{#if messageKey}}
                {{loc messageKey}}
            {{else}}
                {{{message}}}
            {{/if}}
            </span>
        </div>
    </@template>

    <@template id="rate-features-template">
        <#-- TODO: Add dataAttributes="track:${rfrrBase}..." back to all the tooltip links -->
        <#-- TAAP WRAPPER START -->
        {{#if displayTaapContent}}
            {{#if payLaterOffer}}
                {{> taap-etp-template this}}
            {{else}}
                {{#if depositOffer}}
                    {{> taap-etp-template this}}
                {{else}}
                    {{> taap-hotel-type-template this}}
                {{/if}}
            {{/if}}
        {{/if}}
        <#-- TAAP WRAPPER END -->
        <div class="rate-policies">
            <#-- NPP -->
            {{#if hasValueAdd}}
                <div class="offer-value-add">
                    <span class="icon"></span>  <#-- not a UITK icon, see roomsAndRates.less -->
                    <div class="offer-value">
                        <span class="offer-value-add-title free-text "><@loc.msg id="valueAddTitle"/></span>
                        <span class="offer-value-add-text free-text">{{valueAdd.text}}</span>
                    </div>
                </div>
            {{/if}}
            <#-- Free cancellation -->
            {{#if freeCancellable}}
                <#assign freeCencellationTitle><@loc.msg id="freeCencellationTitle" /></#assign>
                <#assign cancellationMessages>
                    <ul>
                        <li>
                            {{#if cancellationMsg_1}}
                            <@loc.msg id="CancellationsMsg_1"/>
                            {{/if}}
                            {{#if cancellationMsg_1_v2}}
                            <@loc.msg id="CancellationsMsg_1_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_2}}
                            <@loc.msg id="CancellationsMsg_2"/>
                            {{/if}}
                            {{#if cancellationMsg_2_v2}}
                            <@loc.msg id="CancellationsMsg_2_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_3}}
                            <@loc.msg id="CancellationsMsg_3"/>
                            {{/if}}
                            {{#if cancellationMsg_3_v2}}
                            <@loc.msg id="CancellationsMsg_3_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_4}}
                            <@loc.msg id="CancellationsMsg_4"/>
                            {{/if}}
                            {{#if cancellationMsg_4_v2}}
                            <@loc.msg id="CancellationsMsg_4_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_5}}
                            <@loc.msg id="CancellationsMsg_5"/>
                            {{/if}}
                            {{#if cancellationMsg_5_v2}}
                            <@loc.msg id="CancellationsMsg_5_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_6}}
                            <@loc.msg id="CancellationsMsg_6"/>
                            {{/if}}
                            {{#if cancellationMsg_6_v2}}
                            <@loc.msg id="CancellationsMsg_6_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_7}}
                            <@loc.msg id="CancellationsMsg_7"/>
                            {{/if}}
                            {{#if cancellationMsg_7_v2}}
                            <@loc.msg id="CancellationsMsg_7_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_8}}
                            <@loc.msg id="CancellationsMsg_8"/>
                            {{/if}}
                            {{#if cancellationMsg_8_v2}}
                            <@loc.msg id="CancellationsMsg_8_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_9}}
                            <@loc.msg id="CancellationsMsg_9"/>
                            {{/if}}
                            {{#if cancellationMsg_9_v2}}
                            <@loc.msg id="CancellationsMsg_9_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_10}}
                            <@loc.msg id="CancellationsMsg_10"/>
                            {{/if}}
                            {{#if cancellationMsg_10_v2}}
                            <@loc.msg id="CancellationsMsg_10_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_11}}
                            <@loc.msg id="CancellationsMsg_11"/>
                            {{/if}}
                            {{#if cancellationMsg_11_v2}}
                            <@loc.msg id="CancellationsMsg_11_v2"/>
                            {{/if}}
                            {{#if cancellationMsg_12}}
                            <@loc.msg id="CancellationsMsg_12"/>
                            {{/if}}
                        </li>
                        {{#if cancellationMsg_13}}
                        <li><@loc.msg id="CancellationsMsg_13"/></li>
                        {{/if}}
                    </ul>
                </#assign>
                <#-- Begin  10264: GROHISCancellationDiscoverability -->
                {{#exp 10264 0}}
                <#-- End  10264: GROHISCancellationDiscoverability -->
                    <#assign freeCancellationLink>
                        <span class="icon icon-success"></span>
                        <span class="free-cancellation-short free-text"><@loc.msg id="freeCancellation"/></span>
                    </#assign>
                    <@uitk.toolTip linkContent="${freeCancellationLink}" contentId="free-cancellation-link{{roomTypeCode}}-{{@index}}" header="${freeCencellationTitle}" arrow="true" position="tl" linkClasses="free-cancellation-tooltip-link"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.FreeCancellation">
                        ${cancellationMessages}
                    </@uitk.toolTip>
                <#-- Begin 10264: GROHISCancellationDiscoverability -->
                {{/exp}}

                {{#exp 10264 1}}
                    <#assign freeCancellationLink>
                        <span class="icon icon-success"></span>
                        <span class="exp10264-1 free-cancellation-short free-text"><@loc.msg id="freeCancellation"/></span>
                        <@uitk.icon name="infoalt" />
                    </#assign>
                    <@uitk.toolTip linkContent="${freeCancellationLink}" contentId="free-cancellation-link{{roomTypeCode}}-{{@index}}" header="${freeCencellationTitle}" arrow="true" position="tl" linkClasses="free-cancellation-tooltip-link"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.FreeCancellation">
                        ${cancellationMessages}
                    </@uitk.toolTip>
                {{/exp}}


                {{#exp 10264 2}}
                    <#assign freeCancellationLink>
                        <span class="exp10264-2 free-cancellation-short free-text"><@loc.msg id="freeCancellation"/></span>
                        <@uitk.icon name="infoalt" />
                    </#assign>
                    <@uitk.toolTip linkContent="${freeCancellationLink}" contentId="free-cancellation-link{{roomTypeCode}}-{{@index}}" header="${freeCencellationTitle}" arrow="true" position="tl" linkClasses="free-cancellation-tooltip-link"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.FreeCancellation">
                        ${cancellationMessages}
                    </@uitk.toolTip>
                {{/exp}}

                {{#exp 10264 3}}
                    <#assign freeCancellationLink>
                        <span class="exp10264-3 free-cancellation-short free-text"><@loc.msg id="freeCancellation"/></span>
                        <@uitk.icon name="infoalt" />
                    </#assign>
                    <@uitk.toolTip linkContent="${freeCancellationLink}" contentId="free-cancellation-link{{roomTypeCode}}-{{@index}}" header="${freeCencellationTitle}" arrow="true" position="tl" linkClasses="free-cancellation-tooltip-link"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.FreeCancellation">
                        ${cancellationMessages}
                    </@uitk.toolTip>
                {{/exp}}
                <#-- End  10264: GROHISCancellationDiscoverability -->
                <div class="free-cancellation-deadline">
                    <@loc.msg id="untilDate"/>
                </div>
            {{/if}}

            {{#unless refundable}}
                <#assign nonRefundableTooltipContent><@loc.msg id="nonRefundableTooltipContent"/></#assign>
                <#-- Begin  10264: GROHISCancellationDiscoverability -->
                {{#exp 10264 0}}
                <#-- End  10264: GROHISCancellationDiscoverability -->
                    <#assign nonRefundableTooltipLink>
                        <div class="non-refundable"><@loc.msg id="nonRefundable"/></div>
                    </#assign>
                    <@uitk.toolTip linkContent='${nonRefundableTooltipLink}' contentId='ShowMoreInformationAboutNon-Refundable-{{roomTypeCode}}-{{@index}}' arrow="true" position="tl" linkClasses="nonRefundableTooltipLink"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.NonRefundable">
                        <p>${nonRefundableTooltipContent}</p>
                    </@uitk.toolTip>
                <#-- Begin 10264: GROHISCancellationDiscoverability -->
                {{/exp}}

                {{#exp 10264 1}}
                    <#assign nonRefundableTooltipLink>
                        <div class="exp10264-1 non-refundable"><@loc.msg id="nonRefundable"/><@uitk.icon name="infoalt" /></div>
                    </#assign>
                    <@uitk.toolTip linkContent='${nonRefundableTooltipLink}' contentId='ShowMoreInformationAboutNon-Refundable-{{roomTypeCode}}-{{@index}}' arrow="true" position="tl" linkClasses="nonRefundableTooltipLink"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.NonRefundable">
                        <p>${nonRefundableTooltipContent}</p>
                    </@uitk.toolTip>
                {{/exp}}

                {{#exp 10264 2}}
                    <#assign nonRefundableTooltipLink>
                        <div class="exp10264-2 non-refundable"><@loc.msg id="nonRefundable"/><@uitk.icon name="infoalt" /></div>
                    </#assign>
                    <@uitk.toolTip linkContent='${nonRefundableTooltipLink}' contentId='ShowMoreInformationAboutNon-Refundable-{{roomTypeCode}}-{{@index}}' arrow="true" position="tl" linkClasses="nonRefundableTooltipLink"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.NonRefundable">
                        <p>${nonRefundableTooltipContent}</p>
                    </@uitk.toolTip>
                {{/exp}}

                {{#exp 10264 3}}
                    <#assign nonRefundableTooltipLink>
                        <div class="exp10264-3 non-refundable"><@loc.msg id="nonRefundable"/><@uitk.icon name="infoalt" /></div>
                    </#assign>
                    <@uitk.toolTip linkContent='${nonRefundableTooltipLink}' contentId='ShowMoreInformationAboutNon-Refundable-{{roomTypeCode}}-{{@index}}' arrow="true" position="tl" linkClasses="nonRefundableTooltipLink"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.NonRefundable">
                        <p>${nonRefundableTooltipContent}</p>
                    </@uitk.toolTip>
                {{/exp}}
                <#-- End 10264: GROHISCancellationDiscoverability -->


            {{/unless}}
        </div>

        <div class="rate-includes">
            <#-- ETP -->
            {{{reserveNowPayLater}}}
            {{{bookNowPayLater}}}
            {{{reserveWithDeposit}}}

            <#-- Breakfast info -->
            {{#if freeBreakfast}}
                <#assign breakfastLink_1><div class="room-amenity free-breakfast"><span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="inclusiveBreakfast"/></span></div></#assign>
                <#assign breakfastLink_2><div class="room-amenity free-breakfast"><span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="fullboardBreakfast"/></span></div></#assign>
                <#assign breakfastLink_3><div class="room-amenity free-breakfast"><span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="halfboardBreakfast"/></span></div></#assign>
                <#assign breakfastLink_4><div class="room-amenity free-breakfast"><span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="breakfastIncluded"/></span></div></#assign>

                {{#if breakfastType_1}}
                    <@uitk.toolTip linkContent="${breakfastLink_1}" id="breakfast-link-{{roomTypeCode}}-{{@index}}" contentId="breakfast-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="240" linkClasses="room-amenity"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Breakfast">
                        <p><@loc.msg id="inclusiveBreakfastDesc"/></p>
                    </@uitk.toolTip>
                {{/if}}
                {{#if breakfastType_2}}
                    <@uitk.toolTip linkContent="${breakfastLink_2}" id="breakfast-link-{{roomTypeCode}}-{{@index}}" contentId="breakfast-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="240" linkClasses="room-amenity"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Breakfast">
                        <p><@loc.msg id="fullboardBreakfastDesc"/></p>
                    </@uitk.toolTip>
                {{/if}}
                {{#if breakfastType_3}}
                    <@uitk.toolTip linkContent="${breakfastLink_3}" id="breakfast-link-{{roomTypeCode}}-{{@index}}" contentId="breakfast-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="240" linkClasses="room-amenity"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Breakfast">
                        <p><@loc.msg id="halfboardBreakfastDesc"/></p>
                    </@uitk.toolTip>
                {{/if}}
                {{#if breakfastType_4}}
                    <@uitk.toolTip linkContent="${breakfastLink_4}" id="breakfast-link-{{roomTypeCode}}-{{@index}}" contentId="breakfast-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="240" linkClasses="room-amenity"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Breakfast">
                        <p><@loc.msg id="freeBreakfastFor2Desc"/></p>
                    </@uitk.toolTip>
                {{/if}}
                {{#if breakfastType_5}}
                    <@uitk.toolTip linkContent="${breakfastLink_4}" id="breakfast-link-{{roomTypeCode}}-{{@index}}" contentId="breakfast-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="240" linkClasses="room-amenity"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Breakfast">
                        <p><@loc.msg id="freeBreakfastDesc"/></p>
                    </@uitk.toolTip>
                {{/if}}
                {{#if breakfastType_6}}
                    <@uitk.toolTip linkContent="${breakfastLink_4}" id="breakfast-link-{{roomTypeCode}}-{{@index}}" contentId="breakfast-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="240" linkClasses="room-amenity"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Breakfast">
                        <p><@loc.msg id="freeBreakfastBuffetDesc"/></p>
                    </@uitk.toolTip>
                {{/if}}
                {{#if breakfastType_7}}
                    <@uitk.toolTip linkContent="${breakfastLink_4}" id="breakfast-link-{{roomTypeCode}}-{{@index}}" contentId="breakfast-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="240" linkClasses="room-amenity"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Breakfast">
                        <p><@loc.msg id="freeBreakfastContinentalDesc"/></p>
                    </@uitk.toolTip>
                {{/if}}
                {{#if breakfastType_8}}
                    <@uitk.toolTip linkContent="${breakfastLink_4}" id="breakfast-link-{{roomTypeCode}}-{{@index}}" contentId="breakfast-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="240" linkClasses="room-amenity"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Breakfast">
                        <p><@loc.msg id="freeBreakfastHotDesc"/></p>
                    </@uitk.toolTip>
                {{/if}}
            {{/if}}

            <#-- Free Parking -->
            {{#if freeParking}}
                <#assign parkingLink>
                    <div class="room-amenity free-parking">
                        <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="freeParking"/></span>
                    </div>
                </#assign>

                <@uitk.toolTip linkContent="${parkingLink}" id="parking-link-{{roomTypeCode}}-{{@index}}" contentId="parking-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="240" linkClasses="room-amenity"
                    dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Parking">
                    <p><@loc.msg id="parkingDescription"/></p>
                </@uitk.toolTip>
            {{/if}}

            <#-- Free Internet -->
            {{#if freeInternet}}
                <#assign internetLink>
                    <div class="room-amenity free-internet">
                        <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="freeInternet"/></span>
                    </div>
                </#assign>

                <@uitk.toolTip linkContent="${internetLink}" id="internet-link-{{roomTypeCode}}-{{@index}}" contentId="internet-{{roomTypeCode}}-{{@index}}" arrow="true" position="tl" width="280" linkClasses="room-amenity"
                    dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Internet">
                    <p><@loc.msg id="internetDescription"/></p>
                </@uitk.toolTip>
            {{/if}}

            <#-- Rate plan description -->
            {{#if hasRatePlanDescription}}
                <#assign ratePlanDescriptionLink>
                    <div class="room-amenity special-deal">
                        <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="specialDeal"/></span>
                    </div>
                </#assign>

                <@uitk.toolTip linkContent="${ratePlanDescriptionLink}" id="rate-description-link{{roomTypeCode}}-{{@index}}" contentId="rate-description{{roomTypeCode}}-{{@index}}" width="396" arrow="true" position="tl" linkClasses="room-amenity rate-description-link"
                    dataAttributes="track:HOT.HIS.RoomsAndRates.Value.Special">
                    <div class="paragraph-hack">{{{ratePlanDescription}}}</div>
                </@uitk.toolTip>
            {{/if}}

            <#-- Other Value Adds -->
            {{#if foodBeverageCredit}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="foodOrBeverageCredit"/></span>
                </div>
            {{/if}}

            {{#if freeAirportParking}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="freeAirportParking"/></span>
                </div>
            {{/if}}

            {{#if freeAirportShuttle}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="freeAirportShuttle"/></span>
                </div>
            {{/if}}

            {{#if freeRoomUpgrade}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="freeRoomUpgrade"/></span>
                </div>
            {{/if}}

            {{#if resortCreditIncluded}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="resortCreditIncluded"/></span>
                </div>
            {{/if}}

            {{#if welcomeGiftUponArrival}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="welcomeGiftUponArrival"/></span>
                </div>
            {{/if}}

            {{#if spaCredit}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="spaCredit"/></span>
                </div>
            {{/if}}

            {{#if golfCredit}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="golfCredit"/></span>
                </div>
            {{/if}}

            {{#if VIPLineAccessToNightclub}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="VIPLineAccessToNightclub"/></span>
                </div>
            {{/if}}

            {{#if freeSkiLiftTicketAndRental}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="freeSkiLiftTicketAndRental"/></span>
                </div>
            {{/if}}

            {{#if slotPlay}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="slotPlay"/></span>
                </div>
            {{/if}}

            {{#if casinoCredit}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="casinoCredit"/></span>
                </div>
            {{/if}}

            {{#if matchPlay}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="matchPlay"/></span>
                </div>
            {{/if}}

            <#-- Begin 10532: HIS_DisplayBreakInternetFees -->
            {{#if displayNewAmenities}}
                <#-- New breakfast amenities -->
                {{#if breakfastIncluded}}
                    <div class="room-amenity free-breakfast">
                        <span class="icon icon-success" aria-hidden="true"></span><span
                            class="free-text"><@loc.msg id="breakfastIncluded"/></span>
                    </div>
                {{/if}}
                {{#if breakfastSurcharge}}
                    <div class="room-amenity free-breakfast">
                        <span class="icon icon-success" aria-hidden="true"></span><span
                            class="free-text"><@loc.msg id="breakfastSurcharge"/></span>
                    </div>
                {{/if}}

                <#-- New Internet amenities -->
                {{#if newFreeInternet}}
                    <div class="room-amenity free-internet">
                        <span class="icon icon-success" aria-hidden="true"></span><span
                            class="free-text"><@loc.msg id="freeInternet"/></span>
                    </div>
                {{/if}}
                {{#if InternetSurcharge}}
                    <div class="room-amenity free-internet">
                        <span class="icon icon-success" aria-hidden="true"></span><span
                            class="free-text"><@loc.msg id="internetSurcharge"/></span>
                    </div>
                {{/if}}
            {{/if}}
            <#-- End   10532: HIS_DisplayBreakInternetFees -->

            {{#if DisneyTickets}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="DisneyTickets"/></span>
                </div>
            {{/if}}

            {{#if spaAccess}}
                <div class="room-amenity value-add">
                    <span class="icon icon-success" aria-hidden="true"></span><span class="free-text"><@loc.msg id="spaAccess"/></span>
                </div>
            {{/if}}

            <#assign cCFeeMsgEnabled = hotelConfig.isCCFeeMsgEnabled() />
            <#assign bookingFeeMsgEnabled = hotelConfig.isBookingFeeMsgEnabled() />
            <#-- No Book and Fees -->
            <div class="room-amenity no-book-and-fees">
                <#if cCFeeMsgEnabled || bookingFeeMsgEnabled><span class="icon icon-success" aria-hidden="true"></span>
                    <span class="free-text"><#if cCFeeMsgEnabled><@loc.msg id="noBookingOrCreditCardFees"/><#else><#if bookingFeeMsgEnabled><@loc.msg id="noBookingFees"/></#if></#if></span>
                </#if>            </div>
            {{#exp 10349 1}}
                <div class="just-booked-green" data-rateplancode="{{ratePlanCode}}">
                </div>
            {{/exp}}

            <#-- Begin 10532: HIS_DisplayBreakInternetFees -->
            {{#if displayNewAmenities}}
                {{#if noBreakfastInfo}}
                    <div class="room-amenity-info">
                        <@loc.msg id="noBreakfastInfo"/>
                    </div>
                {{/if}}
                {{#if noInternetInfo}}
                    <div class="room-amenity-info">
                        <@loc.msg id="noInternetInfo"/>
                    </div>
                {{/if}}
            {{/if}}
            <#-- End   10532: HIS_DisplayBreakInternetFees -->
        </div>
    </@template>

    <@template id="rewards-member-coupon-template">
        {{#if displayExpediaRewards}}
            {{#if loyaltyEarnPoints}}
                <img class="expRewards-icon" src="//images.trvl-media.com/media/content/shared/graphics/other/rewards/logos/er_stacked_193x76.png" alt="<@loc.msg id="expediaPlusRewards"/>"/>

                <#-- Begin 10649:HIS_RewardsPriming  -->
                   {{#exp 10649 1 3}}
                      <#assign rewardPrimingContent>
                          <@uitk.icon name="infoalt" />
                      </#assign>
                      <@uitk.toolTip contentId ="rewardPrimingLink" linkContent="${rewardPrimingContent}" dataAttributes="track:HOT.HIS.RoomAndRates.ExpediaRewardsInfoIcon">  <@loc.msg id="rewardsPrimingMessage"/>
                       </@uitk.toolTip>
                   {{/exp}}
                 <#-- End 10649:HIS_RewardsPriming  -->

                <#-- Begin 9852: HotelIS_MobileUpExpediaRewardsColumn -->
                {{#exp 9852 0}}
                    <div class="expRewards-text expRewards-points"><@uitk.icon name="success"/>
                        <#-- Begin 7936: PwPRewardsUI -->
                        {{#if isPwPRewardsMsg}}
                            {{#if belowRedemptionFloor}}
                                <@loc.msg id="earnPoints"/>
                            {{else}}
                                {{#if isVipAccess}}
                                    <@loc.msg id="redemptionForVIPAccessHotel"/>
                                {{else}}
                                    <@loc.msg id="redemptionForESRHotel"/>
                                {{/if}}
                            {{/if}}
                        <#-- End   7936: PwPRewardsUI -->
                        {{else}}
                            <@loc.msg id="earnPoints"/>
                        {{/if}}
                    </div>
                {{/exp}}
                <#-- End 9852: HotelIS_MobileUpExpediaRewardsColumn -->

                <div class="expRewards-text">
                    <@uitk.icon name="success"/> <@loc.msg id="hotelPriceGuarantee"/>
                </div>
            {{/if}}

            {{#if loyaltyEarnPrice}}
                <img src="/static/default/default/images/infosite/orbitz-logo-rewards.png" class="orbitz-logo-rewards" alt="">
                <ul class="expRewards-list">
                    <li class="rewards-text">
                        <img src="/static/default/default/images/infosite/o-rewards.png" class="o-rewards" alt="">
                        <@loc.msg id="earnPrice"/>
                    </li>
                </ul>
            {{/if}}
        {{/if}}
    </@template>

    <@template id="below-book-button-message-template">

        {{> earn-points-message-template this}}

        <#-- Begin 9852: HotelIS_MobileUpExpediaRewardsColumn -->
        {{#exp 9852 0}}
            <#-- 'It only takes 2 minutes' messaging -->
            <div class="minute-message"><@loc.msg id="takesMinutes"/></div>
        {{/exp}}
        {{#exp 9852 2}}
            {{#if isFeaturedOffer}}
                <#-- 'It only takes 2 minutes' messaging -->
                <div class="minute-message"><@loc.msg id="takesMinutes"/></div>
            {{/if}}
        {{/exp}}
        <#-- End 9852: HotelIS_MobileUpExpediaRewardsColumn -->
    </@template>

    <@template id="earn-points-message-template">
        <#-- Begin 9852: HotelIS_MobileUpExpediaRewardsColumn -->
        {{#exp 9852 1}}
            {{#if displayExpediaRewards}}
                {{#if loyaltyEarnPoints}}
                    <div class="earn-points-message">
                        <img src="/_dms/loyalty/rewards/icon/logo.svg">
                        <#-- Begin 7936: PwPRewardsUI -->
                        {{#if isPwPRewardsMsg}}
                            {{#if belowRedemptionFloor}}
                                <@loc.msg id="earnPoints"/>
                            {{else}}
                                {{#if isVipAccess}}
                                    <@loc.msg id="redemptionForVIPAccessHotel"/>
                                {{else}}
                                    <@loc.msg id="redemptionForESRHotel"/>
                            {{/if}}
                        {{/if}}
                        <#-- End   7936: PwPRewardsUI -->
                        {{else}}
                            <@loc.msg id="earnPoints"/>
                        {{/if}}
                    </div>
                {{/if}}
            {{/if}}
        {{/exp}}

        {{#exp 9852 2}}
            {{#if displayExpediaRewards}}
                {{#if loyaltyEarnPoints}}
                    <div class="earn-points-message">
                        <img src="/_dms/loyalty/rewards/icon/logo.svg">
                        <#-- Begin 7936: PwPRewardsUI -->
                        {{#if isPwPRewardsMsg}}
                            {{#if belowRedemptionFloor}}
                                <@loc.msg id="earnPointsNoBrand"/>
                            {{else}}
                                {{#if isVipAccess}}
                                    <@loc.msg id="redemptionForVIPAccessHotel"/>
                                {{else}}
                                    <@loc.msg id="redemptionForESRHotel"/>
                            {{/if}}
                        {{/if}}
                        <#-- End   7936: PwPRewardsUI -->
                        {{else}}
                            <@loc.msg id="earnPointsNoBrand"/>
                        {{/if}}
                    </div>
                {{/if}}
            {{/if}}
        {{/exp}}
        <#-- End 9852: HotelIS_MobileUpExpediaRewardsColumn -->
    </@template>

    <#-- TAAP WRAPPER START -->
    <@template id="taap-hotel-type-template">
        <div class="taap-hotel-type">
            <span class="taap-hotel-type-label">
                {{#if isTaap.ESR}}
                    ESR
                {{/if}}
                {{#if isTaap.EEM}}
                    EEM
                {{/if}}
                {{#if isTaap.GDS}}
                    GDS
                {{/if}}
            </span>
        </div>
    </@template>

    <@template id="taap-etp-template">
        <div class="taap-hotel-type">
            <@loc.msg id="taapESROrEEMText"/>
        </div>
    </@template>

    <@template id="taap-commission-tooltip-template">
        <#assign showCommissionLoc>Show Commission</#assign>
        <@uitk.toolTip linkContent="${showCommissionLoc?js_string}" linkClasses="taap-commission-tooltip-link" contentId='taap-commission-{{roomTypeCode}}-{{@index}}' tooltipId="taap-commission-tooltipId-{{roomTypeCode}}-{{@index}}" arrow="true" width="500" position="bc" tooltipClasses="taap-commission-tooltip" dataAttributes="track:HOT.HIS.ShowCommission">
        <div class="taapEstimate">
            <p><b><@loc.msg id="taapEstimateText"/></b></p>
        </div>
            <div class="taapCommission">
                {{#if mrp}}
                    {{taapShowCommission price.unformattedTotalPrice commission.ESR currencyPosa}} <@loc.msg id="taapIfBookAsESRText"/>
                    {{taapShowCommission price.unformattedTotalPrice commission.EEM currencyPosa}} <@loc.msg id="taapIfBookAsEEMText"/>
                {{else}}
                    {{#if payLaterOffer}}
                    {{taapShowCommission price.unformattedTotalPrice commission.ESR currencyPosa}} <@loc.msg id="taapIfBookAsESRText"/>
                    {{taapShowCommission price.unformattedTotalPrice commission.EEM currencyPosa}} <@loc.msg id="taapIfBookAsEEMText"/>
                    {{else}}
                        {{#if depositOffer}}
                    {{taapShowCommission price.unformattedTotalPrice commission.ESR currencyPosa}}  <@loc.msg id="taapIfBookAsESRText"/>
                    {{taapShowCommission price.unformattedTotalPrice commission.EEM currencyPosa}}  <@loc.msg id="taapIfBookAsEEMText"/>
                        {{else}}
                            {{#if isTaap.ESR}}
                                {{taapShowCommission price.unformattedTotalPrice commission.ESR currencyPosa}} <@loc.msg id="taapIfBookAsESRText"/>
                            {{/if}}
                            {{#if isTaap.EEM}}
                                {{taapShowCommission price.unformattedTotalPrice commission.EEM currencyPosa}} <@loc.msg id="taapIfBookAsEEMText"/>
                            {{/if}}
                            {{#if isTaap.GDS}}
                                {{taapShowCommission price.unformattedTotalPrice commission.GDS currencyPosa}} <@loc.msg id="taapIfBookAsGDSText"/>
                            {{/if}}
                        {{/if}}
                    {{/if}}
                {{/if}}
            </div>
        <div class="taapExplanation"><@loc.msg id="taapBasedText"/> {{taapTotalPrice price.unformattedTotalPrice currencyPosa}}<@loc.msg id="taapExplanationText"/></div>
        </@uitk.toolTip>
    </@template>
    <#-- TAAP WRAPPER END -->
    <@template id="room-pricing-template">
        <#-- Hierarchical First Room Featured -->
        {{#if isFeaturedOffer}}
            <div class="recommended-for-you">
                <@loc.msg id="recommendedForYou"/>
            </div>
        {{/if}}

        {{#exp 10349 1}}
            <div class="just-booked-red" data-rateplancode="{{ratePlanCode}}">
            </div>
        {{/exp}}

        <#-- Rooms left -->
        {{#if showRoomsLeftMessage}}
            <div class="rooms-left">
                {{#if isNumberOfRoomsLeftSingular}}
                    <@loc.msg id="roomsLeft_Singular"/>
                {{else}}
                    <@loc.msg id="roomsLeft_plural"/>
                {{/if}}
            </div>
        {{/if}}

        {{#if loyaltyBurnedPrice}}
            <#assign pointsAppliedClasses = "points-applied-label"/>
            <#if hotelConfig.isCheapTickets()>
                <#assign pointsAppliedClasses = pointsAppliedClasses + " cheap-tickets-points-applied"/>
            <#elseif hotelConfig.isOrbitz()>
                <#assign pointsAppliedClasses = pointsAppliedClasses + " orbitz-points-applied"/>
            </#if>
            <div class="${pointsAppliedClasses}"><@loc.msg id="pointsApplied"/></div>
        {{/if}}

        <div class="room-price-info-wrapper">
            <#-- Info icon to bring up nightly rates -->
            {{#if showNightlyRates}}
                <#assign nightlyRatesLink>
                    <span class="visuallyhidden"><@loc.msg id="nightlyRatesInformation"/></span>
                    <img class="infoIcon" src="/static/default/default/images/infosite/info-icon.png" alt=""/>
                </#assign>
                <@uitk.menuBar classes="info-icon nightlyRatesMenuBar">
                    <@uitk.menu id="nightlyRatesTooltip_{{roomTypeCode}}-{{@index}}" triggerTitle="${nightlyRatesLink}" dataAttributes="width:auto" arrow="true"
                        dataAttributes="track:HOT.HIS.RoomsAndRates.NightlyRates">
                        <@uitk.menuContent>
                            {{> nightly-rates-template this}}
                        </@uitk.menuContent>
                    </@uitk.menu>
                </@uitk.menuBar>
            {{/if}}

            <#-- Room price -->
            <#-- These messages are for accessibility -->
            <#assign crossOutPriceText><@loc.msg id="priceWas"/></#assign>
            <#assign actualPriceText><@loc.msg id="priceIsNow"/></#assign>

            <div class="price-wrapper {{#unless showNightlyRates}}one-night-room-price{{/unless}}">
            <span class="visuallyhidden">${actualPriceText}</span>
            <span class="room-price {{#if modHisMeatStickerEnabled}}member-price-highlight{{/if}}" aria-describedby="${priceColumnTitle}">
                {{#if loyaltyBurnedPrice}}
                    {{#if roundCurrency}}
                        {{formatPrice loyaltyBurnedPrice.amount round='up'}}
                    {{else}}
                        {{formatPrice loyaltyBurnedPrice.amount}}
                    {{/if}}
                {{else}}
                    {{#if roundCurrency}}
                        {{formatPrice price.price round='up'}}
                    {{else}}
                        {{formatPrice price.price}}
                    {{/if}}
                {{/if}}
            </span>

            <#-- Cross-out price -->
            {{#if price.crossOutPrice}}
                <span class="visuallyhidden">${crossOutPriceText}</span>
                <span class="cross-out-price">
                    {{#if roundCurrency}}
                        {{formatPrice price.crossOutPrice round='up'}}
                    {{else}}
                        {{formatPrice price.crossOutPrice}}
                    {{/if}}
                </span>
            {{else}}
                {{#if averageLoyaltyCrossOutPrice}}
                <span class="visuallyhidden">${crossOutPriceText}</span>
                <span class="cross-out-price">
                    {{#if roundCurrency}}
                        {{formatPrice averageLoyaltyCrossOutPrice.amount round='up'}}
                    {{else}}
                        {{formatPrice averageLoyaltyCrossOutPrice.amount}}
                    {{/if}}
                </span>
                {{/if}}
            {{/if}}

            {{#if modHisMeatStickerEnabled}}
                <div class="member-price">
                    {{#exp 10191 1}}
                        <@loc.msg id="taapAgentDiscout"/>
                    {{/exp}}
                    {{#exp 10191 2}}
                        <img alt="taap-banner-logo" src="/static/default/default/images/marketing/taap/Taap-Agent-Price-Logo.png" class="taap-banner-logo-price-col"><@loc.msg id="memberPrice"/>
                    {{/exp}}
                    {{#exp 10191 0}}
                        <@loc.msg id="memberPrice"/>
                    {{/exp}}
                </div>
            {{/if}}
            </div>

            <#-- Resort Fee -->
            {{#if isResortFeeEnabled}}
                {{#if resortFee}}
                    <div class="resort-fee"><@loc.msg id="resortFeeDetails"/></div>
                {{/if}}
            {{/if}}

            <#-- TODO: PDO-mandatory fees -->

            <#-- TODO: City Tax Exclusion -->
            {{#if price.taxesAndFees}}
                <div class="taxes-and-fees">Additional {{price.taxesAndFees}} taxes & fees</div>
            {{/if}}
            {{#if showTaapAirAttach}}
                <span class="air-attach-banner"><@loc.msg id="taap_package_rate"/></span>
                <span class="air-attach-text">
                    {{#if price.percentageDiscount}}
                       <@loc.msg id="taap_package_air_attach_percent"/>
                    {{else}}
                       <@loc.msg id="taap_package_air_attach_no_percent"/>
                    {{/if}}
                </span>
            {{else}}
            <#-- Air Attach -->
                {{#if airAttach}}
                <span class="air-attach-banner"><@loc.msg id="exclusive_offer"/></span>
                <span class="air-attach-text">
                    {{#if price.percentageDiscount}}
                        <@loc.msg id="air_attach_percent"/>
                    {{else}}
                        <@loc.msg id="air_attach_no_percent"/>
                    {{/if}}
                </span>
                    {{#if airAttachTimeLeft}}
                        <span class="air-attach-timer">
                            <@loc.msg id="air_attachment_timer"/>
                        </span>
                    {{/if}}
                {{/if}}
            {{/if}}
        </div>
    </@template>

    <@template id="room-deal-message-template">
        <#-- Mobile Exclusive DRR -->
        {{#if mobileExclusive}}
            <div class="drr-mobiles-exclusive">
                <@loc.msg id="drr-mobiles-exclusive"/>
            </div>
        {{else}}
            <#-- DRR Message -->
            <#-- TODO: AARP -->
            <#assign badge>
                <@uitk.badge type="urgent" theme="notification" classes="drr-badge" dataAttributes="track:HOT.HIS.RoomAndRates.DRR"><@loc.msg id="sale"/></@uitk.badge>
            </#assign>
            <#assign defaultDrrMessage><@loc.msg id="drrMessage"/></#assign>
            {{#unless airAttach}}
                {{#unless showTaapAirAttach}}
                    {{#if drrpresent}}
                        {{#unless modHisMeatStickerEnabled}}
                            <#-- TODO:  We need to check isShowMemberExclusiveDeals = !isPackageInfosite && !isTVLY && !isTVLYCA && !isWAU && !isWNZ && !isAARP && !isTD && !isDateless
                            && (roomsAndRates.isAuthenticatedUser() || roomsAndRates.isIdentifiedUser()) && roomsAndRates.isHasMemberExclusiveDeals() -->
                            {{#if memberExclusiveDRRPresent}}
                                <span class="member-deal"><@loc.msg id="memberDeal" /></span>
                            {{else}}
                                {{#if hasDrrExpiration}}
                                    <#-- DRR Expiration -->
                                    {{> drr-expiration-template this}}
                                {{else}}
                                    {{#if drrMessage}}
                                        <@uitk.toolTip linkContent='${badge}' contentId="badge-tooltip_{{roomTypeCode}}-{{@index}}" trigger="hover" content="{{drrMessage}}" position="bc" linkClasses="drr-message" />
                                    {{else}}
                                        <@uitk.toolTip linkContent='${badge}' contentId="badge-tooltip_{{roomTypeCode}}-{{@index}}" trigger="hover" content='${defaultDrrMessage}' position="bc" linkClasses="drr-message" />
                                    {{/if}}
                                {{/if}}
                            {{/if}}
                        {{/unless}}
                    {{/if}}
                {{/unless}}
            {{/unless}}
        {{/if}}
    </@template>

    <@template id="drr-expiration-template">
        <#assign expired><@loc.msg id="offerEnded" format="js_string"/></#assign>
        <#assign drrExpiredLink><span class="drr-message">${expired}</span></#assign>
        <#-- Begin 9366: HIS_TonightOnlyDRR -->
        {{#if showTonightOnlyBadge}}
            <#assign tonightOnlyDRRBadge>
                <@uitk.badge type="urgent" theme="notification" classes="drr-badge" dataAttributes="track:HOT.HIS.RoomAndRates.DRR"><@loc.msg id="tonightOnly"/></@uitk.badge>
            </#assign>
            {{#if drrMessage}}
                <@uitk.toolTip linkContent="${tonightOnlyDRRBadge}" contentId="badge-tooltip_{{roomTypeCode}}-{{@index}}" trigger="hover" content="{{tonightOnlyDRRSaveValue}}" position="bc" linkClasses="drr-message" />
            {{else}}
                <@uitk.toolTip linkContent='${tonightOnlyDRRBadge}' contentId="badge-tooltip_{{roomTypeCode}}-{{@index}}" trigger="hover" content='${defaultDrrMessage}' position="bc" linkClasses="drr-message" />
            {{/if}}
        {{/if}}
        <#-- End 9366: HIS_TonightOnlyDRR -->
        {{#if drrExpiration_1}}
            <span class="show-drr-countdown" data-expiration="{{drrExpirationSecsText}}" data-form-index="{{@index}}">
                <span class="drr-expired-tooltip-wrapper hidden">
                    <@uitk.toolTip contentId="drr-expired-tooltips_{{roomTypeCode}}-{{@index}}" linkContent="${drrExpiredLink}" arrow="true" width="300" position="br" linkClasses="drr-expired-tooltip-link" header="${expired}"
                        dataAttributes="track:HOT.HIS.RoomAndRates.DRR">
                        <p><@loc.msg id="drrPopupMsgEnd" format="js_string"/></p>
                    </@uitk.toolTip>
                </span>
                <a href="#" id="drr-countdown_{{roomTypeCode}}-{{@index}}" class="drr-message drr-countdown-tooltip-link" data-control="tooltip" data-title="{{drrMessage}}" data-type1="true" data-type2="false" data-type3="false" data-expiration-date="{{drrExpirationDate}}">
                    <@loc.msg id="lastChance"/>
                    <@loc.msg id="offerEndsIn"/><span id="drr-countdown-timer_{{roomTypeCode}}-{{@index}}" class="drr-countdown-timer"></span>
                </a>
            </span>
        {{/if}}
        {{#if drrExpiration_2}}
            <span class="show-drr-countdown" data-expiration="{{drrExpirationSecsText}}" data-form-index="{{@index}}">
                <span class="drr-expired-tooltip-wrapper hidden">
                    <@uitk.toolTip contentId="drr-expired-tooltips_{{roomTypeCode}}-{{@index}}" linkContent="${drrExpiredLink}" arrow="true" width="300" position="br" linkClasses="drr-expired-tooltip-link" header="${expired}"
                        dataAttributes="track:HOT.HIS.RoomAndRates.DRR">
                        <p><@loc.msg id="drrPopupMsgEnd" format="js_string"/></p>
                    </@uitk.toolTip>
                </span>
                <a href="#" id="drr-countdown_{{roomTypeCode}}-{{@index}}" class="drr-message drr-countdown-tooltip-link" data-control="tooltip" data-title="{{drrMessage}}" data-type1="false" data-type2="true" data-type3="false" data-expiration-date="{{drrExpirationDate}}">
                    <@loc.msg id="hurry"/>
                    <@loc.msg id="offerEndsIn"/><span id="drr-countdown-timer_{{roomTypeCode}}-{{@index}}" class="drr-countdown-timer"></span>
                </a>
            </span>
        {{/if}}
        {{#if drrExpiration_3}}
            <span class="show-drr-countdown" data-expiration="{{drrExpirationSecsText}}" data-form-index="{{@index}}">
                <span class="drr-expired-tooltip-wrapper hidden">
                    <@uitk.toolTip contentId="drr-expired-tooltips_{{roomTypeCode}}-{{@index}}" linkContent="${drrExpiredLink}" arrow="true" width="300" position="br" linkClasses="drr-expired-tooltip-link" header="${expired}"
                        dataAttributes="track:HOT.HIS.RoomAndRates.DRR">
                        <p><@loc.msg id="drrPopupMsgEnd" format="js_string"/></p>
                    </@uitk.toolTip>
                </span>
                <a href="#" id="drr-countdown_{{roomTypeCode}}-{{@index}}" class="drr-message drr-countdown-tooltip-link" data-control="tooltip" data-title="{{drrMessage}}" data-type1="false" data-type2="false" data-type3="true" data-expiration-date="{{drrExpirationDate}}">
                    <@loc.msg id="hurry"/>&nbsp;
                    <@loc.msg id="offerEndsSoon"/>
                </a>
            </span>
        {{/if}}
        {{#if drrExpiration_4}}
            {{#unless showTonightOnlyBadge}} <#-- Unless condition only for Exp 9366: HIS_TonightOnlyDRR -->
                {{#if drrMessage}}
                    <#-- TODO: AARP -->
                    <@uitk.toolTip linkContent="${badge}" contentId="badge-tooltip_{{roomTypeCode}}-{{@index}}" trigger="hover" content="{{drrMessage}}" position="bc" linkClasses="drr-message" />
                {{else}}
                    <@uitk.toolTip linkContent='${badge}' contentId="badge-tooltip_{{roomTypeCode}}-{{@index}}" trigger="hover" content='${defaultDrrMessage}' position="bc" linkClasses="drr-message" />
                {{/if}}
            {{/unless}}
        {{/if}}
    </@template>

    <@template id="room-unavailable-message-template">
        <span class="room-unavailable-message">
            {{#if soldOut}}
                <#-- TODO: EMEA -->
                <@loc.msg id="roomSoldout"/>
                <#-- TODO: How do we ensure only one sold out offer displayed for each room type -->
            {{else}}
                {{#if exceedsMaxAdults}}
                    <@loc.msg id="maxAdultsExceeded"/>
                {{else}}
                    {{#if exceedsMaxChildren}}
                        <@loc.msg id="maxChildrenExceeded"/>
                    {{else}}
                        {{#if childBelowMinAge}}
                            <@loc.msg id="minChildAge"/>
                        {{else}}
                            {{#if exceedsMaxGuests}}
                                <@loc.msg id="maxGuestsExceeded"/>
                            {{else}}
                                <@loc.msg id="notAvailable"/>
                            {{/if}}
                        {{/if}}
                    {{/if}}
                {{/if}}
            {{/if}}
        </span>
    </@template>

    <@template id="book-button-template">
        <#assign bookButtonText>
            <span aria-hidden="true"><@loc.msg id="reserveButtonText"/></span>
            <span class="visuallyhidden"><@loc.msg id="bookButtonTextHierarchical"/></span>
        </#assign>

        <#-- Post directly to UDP -->
        <form method="POST" action="/Details" class="book-now-form">
        {{#if piid}}
            <input type="hidden" name="piid" value="{{piid}}"/>
        {{/if}}
        <input type="hidden" name="action" value="UnifiedDetailsWidget@showDetailsForSelectedOffer"/>
        <input type="hidden" name="hotelID" value="{{hotelID}}"/>
        <input type="hidden" name="roomTypeCode" value="{{roomTypeCode}}"/>
        <input type="hidden" name="ratePlanCode" value="{{ratePlanCode}}"/>
        <input type="hidden" name="inventoryType" value="{{offerType}}"/>
        <input type="hidden" name="dateFormat" value="Localized"/>
        <input type="hidden" name="checkInDate" value="{{checkInDate}}"/>
        <input type="hidden" name="checkOutDate" value="{{checkOutDate}}"/>
        <input type="hidden" name="isPayLater" value="{{#if payLater}}true{{else}}false{{/if}}"/>
        <input type="hidden" name="isPaymentChoiceAvailable"value="{{#if paymentChoiceAvailable}}true{{else}}false{{/if}}"/>
        <input type="hidden" name="isAirAttachmentEnabled" value="{{#if airAttach}}true{{else}}false{{/if}}"/>
        <input type="hidden" name="roomOccupancy" value="{{roomOccupants}}"/>
        {{#if loyaltyBurnedPrice}}
            <input type="hidden" name="prices" value="curc={{currencyPosa}}&amp;pqar={{averageLoyaltyCrossOutPrice.amount}}" />
        {{else}}
            <input type="hidden" name="prices" value="curc={{currencyPosa}}&amp;pqar={{price.price}}" />
        {{/if}}
        {{#if hasValueAdd }} <#-- NPP Data -->
            <input type="hidden" name="valueAddID" value="{{valueAdd.id}}"/>
            <input type="hidden" name="valueAddText" value="{{valueAdd.text}}"/>
            <input type="hidden" name="valueAddVersion" value="{{valueAdd.version}}"/>
        {{/if}}
        <div class="book-button-wrapper">
                {{#if isFeaturedOffer}}
                    <@uitk.button type="submit" btnType="action" level="secondary" classes="book-button" dataAttributes="track:HOT.HIS.RoomsAndRates.BookButton{{bookButtonIndex}}">
                        <#-- TAAP WRAPPER START -->
                        {{#if displayTaapContent}}
                            {{> taap-hotel-type-template this}}
                        {{/if}}
                        <#-- TAAP WRAPPER END -->
                        ${bookButtonText}
                    </@uitk.button>
                {{else}}
                    <@uitk.button type="submit" btnType="sub-action" level="secondary" classes="book-button" dataAttributes="track:HOT.HIS.RoomsAndRates.BookButton{{bookButtonIndex}}">
                        <#-- TAAP WRAPPER START -->
                        {{#if displayTaapContent}}
                            {{> taap-hotel-type-template this}}
                        {{/if}}
                        <#-- TAAP WRAPPER END -->
                        ${bookButtonText}
                    </@uitk.button>
                {{/if}}
            </div>

            {{> below-book-button-message-template this}}

        </form>
    </@template>

    <@template id="etp-book-button-template">
        <#assign bookButtonText>
            <span aria-hidden="true"><@loc.msg id="reserveButtonText"/></span>
            <span class="visuallyhidden"><@loc.msg id="bookButtonTextHierarchical"/></span>
        </#assign>

        <#-- Post directly to UDP -->
        <form method="POST" action="/Details" class="book-now-form">
            {{#if piid}}
                <input type="hidden" name="piid" value="{{piid}}"/>
            {{/if}}
            <input type="hidden" name="action" value="UnifiedDetailsWidget@showDetailsForSelectedOffer"/>
            <input type="hidden" name="hotelID" value="{{hotelID}}"/>
            <input type="hidden" name="roomTypeCode" value="{{roomTypeCode}}"/>
            <input type="hidden" name="ratePlanCode" value="{{ratePlanCode}}"/>
            <input type="hidden" name="inventoryType" value="{{offerType}}"/>
            <input type="hidden" name="dateFormat" value="Localized"/>
            <input type="hidden" name="checkInDate" value="{{checkInDate}}"/>
            <input type="hidden" name="checkOutDate" value="{{checkOutDate}}"/>
            <input type="hidden" name="isPayLater" value="{{#if payLater}}true{{else}}false{{/if}}"/>
            <input type="hidden" name="isPaymentChoiceAvailable"value="{{#if paymentChoiceAvailable}}true{{else}}false{{/if}}"/>
            <input type="hidden" name="isAirAttachmentEnabled" value="{{#if airAttach}}true{{else}}false{{/if}}"/>
            <input type="hidden" name="roomOccupancy" value="{{roomOccupants}}"/>
            {{#if loyaltyBurnedPrice}}
                <input type="hidden" name="prices" value="curc={{currencyPosa}}&amp;pqar={{averageLoyaltyCrossOutPrice.amount}}" />
            {{else}}
                <input type="hidden" name="prices" value="curc={{currencyPosa}}&amp;pqar={{price.price}}" />
            {{/if}}
            {{#if hasValueAdd }} <#-- NPP Data -->
                <input type="hidden" name="valueAddID" value="{{valueAdd.id}}"/>
                <input type="hidden" name="valueAddText" value="{{valueAdd.text}}"/>
                <input type="hidden" name="valueAddVersion" value="{{valueAdd.version}}"/>
            {{/if}}

               <div class="book-button-wrapper">
                <#assign paymentOptionsTitle><@loc.msg id="paymentOptions"/></#assign>
                {{#if isFeaturedOffer}}
                    <@uitk.button type="button" btnType="action" level="secondary" classes="etp-book-button book-button"
                            dataAttributes="track:HOT.HIS.RoomsAndRates.BookButton{{bookButtonIndex}}|roomTypeCode:{{roomTypeCode}}|ratePlanCode:{{ratePlanCode}}|paymentOptions:${paymentOptionsTitle}">
                        <#-- TAAP WRAPPER START -->
                        {{#if displayTaapContent}}
                            {{> taap-etp-template this}}
                        {{/if}}
                        <#-- TAAP WRAPPER END -->
                        ${bookButtonText}
                    </@uitk.button>
                {{else}}
                    <@uitk.button type="button" btnType="sub-action" level="secondary" classes="etp-book-button book-button"
                            dataAttributes="track:HOT.HIS.RoomsAndRates.BookButton{{bookButtonIndex}}|roomTypeCode:{{roomTypeCode}}|ratePlanCode:{{ratePlanCode}}|paymentOptions:${paymentOptionsTitle}">
                        <#-- TAAP WRAPPER START -->
                        {{#if displayTaapContent}}
                            {{> taap-etp-template this}}
                        {{/if}}
                        <#-- TAAP WRAPPER END -->
                        ${bookButtonText}
                    </@uitk.button>
                {{/if}}
            </div>

            {{> below-book-button-message-template this}}

        </form>
    </@template>

    <@template id="mrp-book-button-template">
        <#assign bookButtonText>
            <span aria-hidden="true"><@loc.msg id="reserveButtonText"/></span>
            <span class="visuallyhidden"><@loc.msg id="bookButtonTextHierarchical"/></span>
        </#assign>
        <#assign mrpModalTitle><@loc.msg id="mrpModalTitle"/></#assign>
        <div class="book-button-wrapper">
            {{#if isFeaturedOffer}}
                <@uitk.button type="button" btnType="action" level="secondary" classes="mrp-book-button book-button" dataAttributes="track:HOT.HIS.RoomsAndRates.BookNow{{bookButtonIndex}}.MixRate.open|mrpmodaltitle:${mrpModalTitle}|roomTypeCode:{{roomTypeCode}}|bookButtonIndex:{{bookButtonIndex}}|offer-index:{{offerIndex}}">
                    <#-- TAAP WRAPPER START -->
                    {{#if displayTaapContent}}
                        {{> taap-etp-template this}}
                    {{/if}}
                    <#-- TAAP WRAPPER END -->
                    ${bookButtonText}
                </@uitk.button>
            {{else}}
                <@uitk.button type="button" btnType="sub-action" level="secondary" classes="mrp-book-button book-button" dataAttributes="track:HOT.HIS.RoomsAndRates.BookNow{{bookButtonIndex}}.MixRate.open|mrpmodaltitle:${mrpModalTitle}|roomTypeCode:{{roomTypeCode}}|bookButtonIndex:{{bookButtonIndex}}|offer-index:{{offerIndex}}">
                    <#-- TAAP WRAPPER START -->
                    {{#if displayTaapContent}}
                        {{> taap-etp-template this}}
                    {{/if}}
                    <#-- TAAP WRAPPER END -->
                    ${bookButtonText}
                </@uitk.button>
            {{/if}}
        </div>

        {{> below-book-button-message-template this}}

    </@template>

    <@template id="back-to-search-template">
        {{#if isDeeplink}}
            <a id="back-to-search" href="{{backToSearchUrl}}" data-track-page="{{rfrrBase}}SeeMoreHotels">
                <@uitk.icon name="toggle270" />
                <span class="long-back-to-search">
                    <@loc.msg id="seeMoreHotels"/>
                </span>
                <span class="short-back-to-search">
                    <@loc.msg id="more" comment="shortened version of see more to search link"/>
                </span>
            </a>
        {{else}}
            <#-- Back to search results -->
            <a id="back-to-search" href="{{backToSearchUrl}}" data-track-page="{{rfrrBase}}BackToSearch">
                <@uitk.icon name="toggle270" />
                <span class="long-back-to-search">
                    <@loc.msg id="backToSearch"/>
                </span>
                <span class="short-back-to-search">
                    <@loc.msg id="back" comment="shortened version of back to search link"/>
                </span>
            </a>
        {{/if}}
    </@template>

    <@template id="playback-module-template">
        <@uitk.icon name="hotels" />
        {{#if cityName}}
            &nbsp;{{cityName}}&nbsp;&bull;
        {{/if}}

        {{#if checkInDay}}
            {{#if checkOutDay}}
                {{checkInDay}}&nbsp;-&nbsp;{{checkOutDay}}&nbsp;&bull;
            {{/if}}
        {{/if}}

        {{#if numberOfRooms}}
            <@loc.msg id="moreThanOneRoom" comment="roomCount will be a numeric value greater than 1."/>
        {{else}}
            <@loc.msg id="oneRoom"/>
        {{/if}}
    </@template>

    <@template id="lead-price-template">
        {{#unless showSoldOut}}
            {{#unless isDateless}}
                {{#if isModHisMeatStickerEnabled}}
                    <div class="price-row {{#if hasLoyaltyBurn}}swpAdjust{{/if}}">
                        <div class="price-col {{#if hasLoyaltyBurn}}swpAdjust{{/if}}">
                {{/if}}
            {{/unless}}

            {{#if hasLoyaltyBurn}}
                <#-- TODO: We should never need to do this.. The branding color should already be handled by UITK -->
                <#assign pointsAppliedClasses = "points-applied"/>
                <#if hotelConfig.isCheapTickets()>
                    <#assign pointsAppliedClasses = pointsAppliedClasses + " cheap-tickets-points-applied"/>
                <#elseif hotelConfig.isOrbitz()>
                    <#assign pointsAppliedClasses = pointsAppliedClasses + " orbitz-points-applied"/>
                </#if>
                <div class="pay-with-points-wrapper">
                    <span class="${pointsAppliedClasses}"><@loc.msg id="pointsApplied"/></span>
            {{/if}}

            {{#if isDateless}}
                <#-- Choose dates button -->
                <@uitk.button type="link" href="#availability-header" btnType="action" id="choose-dates-button" level="secondary"><@loc.msg id="chooseDates"/></@uitk.button>
            {{else}}
                {{#if available}}
                    <#-- Strike-through price -->
                    {{#if crossOutPrice}}
                        <span class="visuallyhidden"><@loc.msg id="priceWas"/></span> <span class="cross-out-price">{{crossOutPrice}}</span>
                    {{else}}
                        {{#if averageLoyaltyCrossOutPrice}}
                            <span class="visuallyhidden"><@loc.msg id="priceWas"/></span> <span class="cross-out-price">{{averageLoyaltyCrossOutPrice}}</span>
                        {{/if}}
                    {{/if}}
                    <#-- Lead Price -->
                    {{#if minPrice}}
                        <span class="visuallyhidden"><@loc.msg id="priceIsNow"/></span> <a href="#availability-header" class="price link-to-rooms {{#if isModHisMeatStickerEnabled}}member-price-highlight{{/if}}" data-track="HOT.HIS.LEADPRICE">{{minPrice}}</a>
                    {{/if}}

                    {{#if isModHisMeatStickerEnabled}}
                        <div class="member-price-above">
                           {{#exp 10191 1}}
                                <@loc.msg id="taapAgentDiscout"/>
                           {{/exp}}
                           {{#exp 10191 2}}
                                <img alt="taap-banner-logo" src="/static/default/default/images/marketing/taap/Taap-Agent-Price-Logo.png" class="taap-banner-logo-price-col"><@loc.msg id="memberPrice"/>
                           {{/exp}}
                           {{#exp 10191 0}}
                                <@loc.msg id="memberPrice"/>
                           {{/exp}}
                        </div>
                    {{/if}}

                    {{#if hasLoyaltyBurn}}
                        </div>
                    {{/if}}

                {{#if isModHisMeatStickerEnabled}}
                    </div>
                    <div class="button-col">
                {{/if}}

                    <#-- Book Button Above Fold -->
                    <div class="mock-book-button-wrapper">
                        <@uitk.button id="mock-book-button" type="button" level="secondary" classes="link-to-rooms" dataAttributes="track:HOT.HIS.LEADPRICEBOOKBUTTON"><@loc.msg id="mockReserveButton"/></@uitk.button>
                    </div>

                {{#if isModHisMeatStickerEnabled}}
                    </div>
                {{/if}}


                    {{#if leadPriceResortFeeEnabled}}
                        {{#if resortFee}}
                            <div class="excludes-fee"><@loc.msg id="excludesFee"/></div>
                        {{/if}}
                    {{/if}}
                {{/if}}
            {{/if}}
        {{/unless}}
    </@template>

    <@template id="price-change-template">
        {{#if hasPriceDifference}}
            <#assign priceChangeTitle><@loc.msg id="PriceChange" /></#assign>
            <@uitk.alert id="priceDifferenceAlert" type="info" title="${priceChangeTitle}"> <@loc.msg id="priceChangeCurrency" />  </@uitk.alert>
        {{/if}}
    </@template>

    <#-- Begin 10649:HIS_RewardsPriming  -->
      <@template id="rewards-priming-template">
          {{#exp 10649 1 2}}
              <#assign rewardsPriming><@loc.msg id="rewardsPriming" /></#assign>
              <@uitk.box type="simple" id="rewards-priming-box" classes="col">

               <div id="rewardsName">
                       <@loc.msg id="rewardsPriming"/>
               </div>
         		<article class="one-col-section cols-nested" >
                      <div class="col">
                          <div id="rewardsPrimingPoints"><@loc.msg id="rewardsPrimingPoints" /></div>
                          <div id ="rewardsPrimingSignUp"><@loc.msg id="rewardsPrimingSignUp" /></div>
                       </div>
              </@uitk.box>
          {{/exp}}
      </@template>
      <#-- End 10649:HIS_RewardsPriming  -->

</#macro>
